/*详情页数据*/ ;
! function($) {
    var $cear_img = $('.cear_img');
    var $img_box = $('.img_box');
    var $loupe = $('.loupe');
    //console.log(location.href.split('=')[1]);
    $.ajax({
            type: 'post',
            url: 'http://10.31.156.25/1804/moto/php/details.php',
            data: {
                sid: location.href.split('=')[1]
            },
            dataType: 'json'
        }).done(function(d) {
            var $str = '';
            var $arr = d.src.split(',');
            var $title = d.title.split(',');
            var $color = d.color.split(',');
            var $present = d.present.split(',');
            var $arr1 = d.complimentary.split(',');
            var $pic = d.comppic.split(',');
            var $zp = '';
            var $img = '';
            var $color1 = '';
            var $present1 = '';
            $.each($arr1, function(index, value) {
                if (value) {
                    $zp += '<li class="zengpin"><span class="money_t"> 赠　品:</span ><ul class="money_text"> <li><a href="#"><img src="' + $pic[index] + '" alt=""><span>' + value + '</span></a></ul></li>'
                } else {
                    $zp = '';
                }
            })

            $.each($arr, function(index, value) {
                $img += '<li class="active minpic"><img src="' + value + '" alt=""></li>'
            })

            $.each($color, function(index, value) {
                $color1 += '<li><span></span>' + value + '</li>';
            })

            $.each($present, function(index, value) {
                $present1 += '<li><span></span>' + value + '</li>';
            })
            if (d.color) {
                $str += '<div class="loupe"><div class="img_box" ><img src="' + $arr[1] + '" alt=""><div id="sf"></div></div><div id="bf"><img src="" id="bpic"></div><ul class="cear_img">' + $img + '</ul></div><div class="deta_box_right clear"><h3>' + $title[1] + '</h3><p>' + d.text + '<br><p class="moblie">' + d.comppictitle + '</p></p><ul class="sale"><li><span class="money_t">价　格:</span><div class="sale_price"><span>¥' + d.price + '</span></div></li>' + $zp + '<li><span class="money_t">支　持:</span><ul class="support"><li><img src="https://image.motorola.com.cn/shop_v4/images/hb-icon.png" alt=""> 花呗分期3期,6期免息</li><li><img src="https://image.motorola.com.cn/shop_v4/images/sf-icon.png" alt=""> 顺丰配送</li><li><img src="https://image.motorola.com.cn/shop_v4/images/seven-icon.png" alt=""> 7天无理由退货</li></ul></ul><div class="pro"><h3>选择颜色</h3><ul>' + $color1 + '</ul></div><div class="pro"><h3>选择版本</h3><ul>' + $present1 + '</ul></div><div class="sum"><h3>选择数量</h3><div class="number"><span class="min">-</span><input type="text" class="n_input" value="1"><span class="max">+</span></div><div class="sum_btn"><a href="javascript:;">加入购物车</a></div></div></div>'
            } else {
                $('.deta_box').css('display', 'none');
            }
            $('.deta_box').html($str);
        })
        /*事件委托*/
    $('.deta_box').on('click', '.minpic', function() {
        $(this).addClass("active").siblings().removeClass("active");
        let src = $(this).find('img').attr('src');
        $(this).parents('.deta_box').find('.img_box img').prop({ 'src': src });
    })

    /*事件委托*/
    $('.deta_box').on('click', '.max', function() {
        var $count = $(this).parents('.deta_box').find('.number input').val();
        $count++;
        if ($count >= 99) {
            $count = 99;
        }
        $(this).parents('.deta_box').find('.number input').val($count);
    })

    /*事件委托*/
    $('.deta_box').on('click', '.min', function() {
            var $count = $(this).parents('.deta_box').find('.number input').val();
            $count--;
            if ($count <= 1) {
                $count = 1;
            }
            $(this).parents('.deta_box').find('.number input').val($count);
        })
        /*放大镜*/
    $('.deta_box').on('mousemove', '.img_box', function(ev) {
        var $bf = $('#bf')
        var $sf = $('#sf')
        var $spic = $('.img_box')
        var $bpic = $('#bpic');
        var $wrap = $('.loupe');
        let src = $(this).find('img').attr('src');

        $(this).parents('.deta_box').find('#bf img').prop({ 'src': src });
        $(this).parents('.deta_box').find('#bf').show();
        $(this).parents('.deta_box').find('#sf').show();


        $sf.width($spic.width() * $bf.width() / $bpic.width());
        $sf.height($spic.height() * $bf.height() / $bpic.height());
        var $scale = $bf.width() / $sf.width();

        var $x = ev.clientX - $wrap.offset().left - $sf.width() / 2;
        var $y = ev.clientY - $wrap.offset().top - $sf.height() / 2;

        if ($x < 0) {
            $x = 0;
        } else if ($x >= $spic.width() - $sf.width() - 2) {
            $x = $spic.width() - $sf.width() - 2;
        }
        if ($y < 0) {
            $y = 0;
        } else if ($y >= $spic.height() - $sf.height() - 2) {
            $y = $spic.height() - $sf.height() - 2;
        }
        $sf.css('left', $x + 'px');
        $sf.css('top', $y + 'px');
        $bpic.css('left', -$x * $scale + 'px');
        $bpic.css('top', -$y * $scale + 'px');
    })
    $('.deta_box').on('mouseout', '.img_box', function() {
        $(this).parents('.deta_box').find('#bf').hide();
        $(this).parents('.deta_box').find('#sf').hide();
    })
}(jQuery)